---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import ProductCard from '../components/ProductCard.astro';
import Footer from '../components/Footer.astro';
import { getProducts, getCategories } from '../data/apiService';
import "../styles/global.css";

// Láº¥y dá»¯ liá»‡u sáº£n pháº©m tá»« API
const products = await getProducts();
// Láº¥y danh sÃ¡ch danh má»¥c
const categories = getCategories(products);

// ThÃªm option "Táº¥t cáº£" vÃ o Ä‘áº§u danh sÃ¡ch
const allCategories = [
  { name: 'Táº¥t cáº£', rank: 0, color: '#cccccc' },
  ...categories
];

// List category filter (cÃ³ Táº¥t cáº£ Ä‘áº§u tiÃªn)

const defaultCategory = "gau-bong";
---

<Layout title="Gáº¡o LÃ¢m ThÃºy - Gáº¡o cháº¥t lÆ°á»£ng cao">
  <Navbar />
  
  <main class="container mx-auto px-4 py-8">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-primary mb-4">ðŸŒ¾ Gáº¡o LÃ¢m ThÃºy</h1>
      <p class="text-lg text-base-content opacity-80 max-w-2xl mx-auto">
        ChuyÃªn cung cáº¥p cÃ¡c loáº¡i gáº¡o cháº¥t lÆ°á»£ng cao, thÆ°Æ¡ng hiá»‡u uy tÃ­n táº¡i Viá»‡t Nam
      </p>
    </div>

    <!-- Filter radio group scroll ngang cÃ³ Táº¥t cáº£ -->
    <div class="w-full overflow-x-auto mb-8">
      <form id="filter-form" class="flex gap-2 overflow-x-auto px-1 pb-2">
  {allCategories.map((cat, index) => (
    <label
      class="relative cursor-pointer"
      style={`--border-color: ${cat.color};`}
    >
      <input
        type="radio"
        name="category"
        value={cat.name}
        checked={index === 0}
        class="peer hidden"
      />
      <div
        class="px-3 py-1 text-sm border rounded-full whitespace-nowrap 
               peer-checked:bg-[var(--border-color)] peer-checked:text-white 
               hover:bg-[var(--border-color)] hover:text-white 
               border-[var(--border-color)] transition-all duration-150"
      >
        {cat.name}
      </div>
    </label>
  ))}
</form>

    </div>

    <!-- Product grid -->
    <div id="products-gallery" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
      {products.map((product) => (
        <div data-category={product.category.name}>
          <ProductCard product={product} />
        </div>
      ))}
    </div>
  </main>

  <Footer />
</Layout>

<!-- Script filter báº±ng JS thuáº§n, lá»c product theo radio -->
<script>
  const form = document.getElementById('filter-form');
  const grid = document.getElementById('products-gallery');
  const allItems = Array.from(grid.children);

  // Lá»c khi radio thay Ä‘á»•i
  form.addEventListener('change', (e) => {
    const value = form.category.value;
    
    allItems.forEach(item => {
      if (value === 'Táº¥t cáº£' || item.dataset.category === value) {
        item.style.display = '';
      } else {
        item.style.display = 'none';
      }
    });
  });
</script>

<!-- ThÃªm PhotoSwipe script -->
<script type="module" src="/photoswipe-init.js"></script>

<style>
  /* TÃ¹y chá»‰nh mÃ u cho radio button theo category */
  input[type="radio"].btn::before {
    background-color: var(--cat-color, #cccccc);
  }
</style>
